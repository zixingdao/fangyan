# 长沙方言采集平台 - 项目文档

## 一、项目概述

### 1.1 项目名称
**"湘音传承·长沙方言守护计划"**

### 1.2 项目背景
为阿里公司采集长沙方言数据，目标总时长达到5000小时以上。通过招募邵阳学院的长沙籍学生参与方言录制，保护和传承长沙方言文化。

### 1.3 核心目标
- 招募邵阳学院长沙籍学生参与方言录制
- 单人录制：80-120元/小时
- 完成5000小时以上的方言数据采集

### 1.4 完整流程

```
用户注册 → 录制方言 → 上传音频 → [跳转标注平台] → 标注完成 → 审核通过 → 计算收益 → 发放奖励
                ↑________________________________________________↓
                                    （标注不通过需重新录制）
```

**关键节点说明**：
1. **录制上传**：用户按引导完成方言录制并上传
2. **跳转标注**：网页提供第三方标注平台链接，用户前往标注
3. **标注完成**：用户在标注平台完成数据标注
4. **审核通过**：标注完成且质量合格后，才算正式完成
5. **计算收益**：按审核通过的时长计算报酬
6. **榜单排名**：仅统计审核通过的录制时长

> 📝 **说明**：数据标注在第三方平台进行，本网站仅提供跳转链接

### 7.4 部署说明 (双端分离)
- **独立构建**：
  - 用户端：`frontend-user` 构建后放入后端 `public/user` 目录。
  - 管理端：`frontend-admin` 构建后放入后端 `public/admin` 目录。
- **集成部署**：后端 NestJS 配置静态资源托管，并设置 SPA 回退路由。
  - 访问 `/` -> 指向用户端 (public/user/index.html)
  - 访问 `/admin` -> 指向管理端 (public/admin/index.html)
- **优势**：
  - **故障隔离**：用户端代码报错崩溃，不影响管理员访问后台进行维护。
  - **独立更新**：可以单独发布用户端新功能，而无需重新构建管理端。

---

## 二、功能需求

### 2.1 前端功能

#### 2.1.1 主页（Landing Page）
| 模块 | 功能描述 |
|------|----------|
| **活动标题区** | 展示"湘音传承·长沙方言守护计划"，配合长沙元素视觉设计 |
| **核心信息** | 醒目展示"找邵阳学院的长沙人"、"方言录制 80-120元/小时"、"单人最多20小时，多人最多100小时" |
| **荣誉激励区** | 展示荣誉体系：湘音传承大使、长沙方言守护者、方言文化贡献者、速度之星 |
| **数据榜单** | 时长荣誉榜（按录制时长排名）、质量之星榜（按音频质量评级） |
| **录制引导** | 引导用户了解录制方式（单人/多人对话） |
| **登录/注册** | 右上角放置登录/注册入口 |

#### 2.1.2 用户系统
| 功能 | 描述 |
|------|------|
| 用户注册 | 学号+手机号+姓名+密码注册，验证邵阳学院身份 |
| 用户登录 | 学号+密码登录 |
| 个人中心 | 查看个人录制数据、排名、收益、标注状态 |
| 密码修改申请 | 提交修改密码申请（填写学号+手机号+申请理由），等待管理员审核 |
| 标注跳转 | 提供第三方标注平台链接，引导用户完成标注 |

#### 2.1.3 录制引导页面

**录制规则说明：**
| 录制类型 | 时长限制 | 说明 |
|----------|----------|------|
| 单人录制 | 最多20小时 | 单人独自录制方言 |
| 多人对话 | 最多100小时 | 与家人/朋友对话录制 |

**单人录制引导：**
- 说明：直接给稿子读起来生硬，采用引导式提问
- 引导方式：
  - 提供话题场景（如：讲讲你小时候的长沙过年习俗）
  - 提问式引导（如：你最想念长沙的什么美食？为什么？）
  - 回忆式引导（如：描述一下你印象最深刻的长沙老街）

**多人对话引导：**
- 场景设置：学生与父母的对话
- 话题示例：
  - "爸妈，你们年轻时长沙是什么样子的？"
  - "我们家有什么特别的长沙话说法？"
  - "讲讲我们家族的长沙故事"
- 目的：营造自然对话氛围，让参与者滔滔不绝地讲述

#### 2.1.4 荣誉体系页面

**时长荣誉榜 💰：**

| 排名 | 荣誉称号 | 奖励 | 评定标准 |
|------|----------|------|----------|
| 第1名 | "湘音传承大使" | 证书 + **额外奖金** | 总录制时长第1名 |
| 第2-3名 | "长沙方言守护者" | 证书 + **奖金** | 总录制时长前3名 |
| 第4-10名 | "方言文化贡献者" | 电子证书 | 总录制时长前10名 |
| 速度之星 | "速度之星" | 证书 + **奖金** | 最先完成20小时（单人）/100小时（多人）且**标注审核通过** |
| 参与奖 | "方言参与者" | 纪念证书 | 完成指定录制时长且**标注审核通过** |

> 💡 **榜单说明**：榜单按总录制时长排名。若多人达到20/100小时上限，则按达到上限的先后顺序排列。
> 
> 📋 **完成标准**：录制上传 → 数据标注 → 审核通过，才算正式完成

**质量之星榜 💰：**
| 等级 | 荣誉称号 | 评定标准 | 奖励 |
|------|----------|----------|------|
| 五星 | "方言大师" | 音质极佳、方言纯正、内容丰富完整 | 证书 + **奖金** |
| 四星 | "方言达人" | 音质良好、方言标准、内容较完整 | 证书 + **奖金** |
| 三星 | "方言新秀" | 音质合格、方言基本标准 | 电子证书 |

### 2.2 后端管理功能

#### 2.2.1 用户管理
- 用户列表查看
- 用户身份审核（验证邵阳学院学生身份）
- **试音状态管理**
  - 管理员手动更新用户的试音状态（通过/不通过）
  - 支持批量导入试音通过名单
- 用户状态管理（启用/禁用）
- **密码修改申请管理**
  - 查看用户提交的密码修改申请
  - 审核申请（验证学号+手机号）
  - 审核通过后为用户重置密码
  - 密码修改记录

#### 2.2.2 数据管理
- 录制数据查看（用户、时长、上传时间、标注状态）
- **数据导入管理**
  - **批量导入录制记录**：管理员上传Excel/CSV，包含用户学号、录制时长、文件名等信息
  - **批量更新标注状态**：导入最新的标注结果，更新系统内记录状态
- 数据统计报表
  - 总录制时长
  - 每日/每周/每月新增时长
  - 参与人数统计
  - 标注完成率统计
- 数据导出功能

#### 2.2.3 榜单管理
- 榜单数据管理
- 荣誉奖项设置
- 榜单刷新机制

#### 2.2.4 内容管理
- 录制引导内容编辑
- 话题场景管理
- 荣誉体系配置

#### 2.2.5 系统管理
- 管理员账号管理
- 操作日志
- **全局参数配置**
  - **薪酬参数**：配置录制时薪范围（当前：80-120元/小时）
  - **试音配置**：管理试音链接、试音二维码、官方钉钉群信息
  - **榜单配置**：动态调整排行榜奖金（如第1名2000元）和称号
- 系统配置

#### 2.2.6 日志管理
- **系统日志**
  - 用户操作日志（登录、上传、修改等）
  - 管理员操作日志
  - 系统异常日志
- **日志查询**
  - 按时间范围查询
  - 按用户查询
  - 按操作类型查询
- **日志导出**
  - 支持导出为Excel/CSV格式
  - 日志归档管理

---

## 三、技术架构

### 3.1 技术栈选型

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端** | React 18 + TypeScript + Vite | 现代化前端框架，生态丰富 |
| **UI组件库** | Ant Design / Material UI | 成熟的 React 组件库 |
| **后端** | Node.js (NestJS) | 企业级框架，模块化架构 |
| **数据库** | MySQL + (Redis 可选) | 关系型数据 + (后期考虑缓存) |
| **文件存储** | 阿里云OSS / 本地存储 | 录制文件存储 |
| **部署** | Nginx + Docker | 反向代理+容器化部署 |

### 3.2 系统架构图
（采用前后端集成部署模式：Node.js 同时负责 API 服务和 静态页面托管）

```
┌─────────────────────────────────────────────────────────────┐
│                      客户端 (Browser)                        │
│            访问 / (React页面)    访问 /api (后端接口)         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  后端服务层 (Node.js + NestJS)               │
│  ┌────────────────────┐   ┌──────────────────────────────┐  │
│  │  静态资源托管       │   │          API 接口服务         │  │
│  │ (React Build Dist) │   │ (Auth, User, Record, Admin)  │  │
│  └────────────────────┘   └──────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐                     │
│  │  MySQL   │ │ (Redis)  │ │  OSS存储 │                     │
│  └──────────┘ └──────────┘ └──────────┘                     │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 数据库设计（核心表）

#### 用户表 (users)
```sql
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  student_id VARCHAR(50) UNIQUE NOT NULL COMMENT '学号（登录账号）',
  phone VARCHAR(20) UNIQUE NOT NULL COMMENT '手机号',
  name VARCHAR(50) NOT NULL COMMENT '姓名',
  password VARCHAR(255) NOT NULL COMMENT '密码',
  school VARCHAR(100) DEFAULT '邵阳学院' COMMENT '学校',
  hometown VARCHAR(100) COMMENT '籍贯（长沙）',
  status TINYINT DEFAULT 0 COMMENT '状态：0待审核 1已通过 2已拒绝',
  total_duration INT DEFAULT 0 COMMENT '总录制时长（分钟）',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 录制记录表 (recordings)
```sql
CREATE TABLE recordings (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL COMMENT '用户ID',
  duration INT NOT NULL COMMENT '时长（分钟）',
  file_url VARCHAR(500) COMMENT '文件地址',
  record_type TINYINT COMMENT '类型：1单人 2多人',
  upload_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  status TINYINT DEFAULT 0 COMMENT '状态：0待标注 1标注中 2已标注 3审核通过 4审核拒绝',
  annotation_url VARCHAR(500) COMMENT '标注平台链接',
  annotation_time TIMESTAMP COMMENT '标注完成时间',
  remark VARCHAR(500) COMMENT '备注'
);
```

#### 榜单记录表 (rankings)
```sql
CREATE TABLE rankings (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  rank_type VARCHAR(20) COMMENT '榜单类型：day/week/month/total',
  rank_number INT COMMENT '排名',
  duration INT COMMENT '统计时长',
  period_start DATE COMMENT '统计周期开始',
  period_end DATE COMMENT '统计周期结束'
);
```

#### 密码修改申请表 (password_reset_requests)
```sql
CREATE TABLE password_reset_requests (
  id INT PRIMARY KEY AUTO_INCREMENT,
  student_id VARCHAR(50) NOT NULL COMMENT '学号',
  phone VARCHAR(20) NOT NULL COMMENT '手机号',
  reason VARCHAR(500) COMMENT '申请理由',
  status TINYINT DEFAULT 0 COMMENT '状态：0待审核 1已通过 2已拒绝',
  admin_id INT COMMENT '审核管理员ID',
  admin_remark VARCHAR(500) COMMENT '管理员备注',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## 四、页面设计规划

### 4.1 页面清单

| 页面 | 路径 | 说明 |
|------|------|------|
| 首页 | / | 活动展示、荣誉、榜单、引导 |
| 登录 | /login | 用户登录 |
| 注册 | /register | 用户注册 |
| 个人中心 | /profile | 个人数据、排名、收益、标注状态、标注跳转链接 |
| 录制引导 | /guide | 单人/多人录制引导说明 |
| 话题场景 | /topics | 具体话题列表 |
| 数据榜单 | /ranking | 排行榜 |
| 荣誉墙 | /honor | 荣誉体系说明 |

### 4.2 管理后台页面

| 页面 | 路径 | 说明 |
|------|------|------|
| 登录 | /admin/login | 管理员登录 |
| 仪表盘 | /admin/dashboard | 数据统计概览（新增试音通过率、待审核人数） |
| 用户管理 | /admin/users | 用户列表、身份审核、**试音审核** |
| 录制管理 | /admin/recordings | 录制数据管理、数据上传 |
| 榜单管理 | /admin/rankings | 榜单配置、荣誉奖项设置 |
| 内容管理 | /admin/content | 引导内容编辑、话题场景管理 |
| 系统设置 | /admin/settings | 系统配置、标注链接配置 |
| 日志管理 | /admin/logs | 系统日志查看、导出 |

---

## 五、UI/UX 设计要点

### 5.1 视觉风格
- **主色调**：长沙元素（橙色/红色系，代表热情、辣椒文化）
- **辅助色**：深蓝色/墨绿色（稳重、文化感）
- **字体**：现代简洁的中文字体
- **风格**：精致、现代、有文化气息

### 5.2 关键设计元素
- 首页大幅Banner展示活动主题
- 数据榜单实时滚动效果
- 荣誉徽章展示
- 录制引导采用卡片式布局
- 响应式设计，支持移动端

---

## 六、项目开发计划

### 6.1 开发阶段

| 阶段 | 时间 | 任务 |
|------|------|------|
| **第一阶段** | 1-2周 | 基础架构搭建、数据库设计、用户系统 |
| **第二阶段** | 2-3周 | 主页开发、录制引导页面、数据榜单 |
| **第三阶段** | 2周 | 管理后台开发 |
| **第四阶段** | 1周 | 测试、优化、部署 |

### 6.2 目录结构

```
长沙方言软件/
├── pnpm-workspace.yaml       # [Monorepo] 工作区配置
├── packages/                 # [共享层]
│   ├── shared/               # [核心] 全局共享库 (Schema-First)
│   │   ├── src/
│   │   │   ├── schemas/     # -> Zod Schemas (API验证、表单验证共用)
│   │   │   ├── types/       # -> 从 Schema 自动推导的 TS 类型
│   │   │   └── constants/   # -> 业务常量
│   │   └── package.json
│   ├── ui/                   # [新增] UI 组件库 (React + Ant Design / Tailwind)
│   │   ├── src/             
│   │   │   ├── components/  # -> 基础组件 (Button, Input, Modal)
│   │   │   ├── hooks/       # -> 通用 Hooks (useDebounce, useToggle)
│   │   │   └── utils/       # -> UI 工具函数 (classNames)
│   │   └── package.json
├── apps/                     # [应用层]
│   ├── client/               # (原 frontend-user) 用户端 (React)
│   │   ├── src/
│   │   │   ├── features/    # 业务特性 (引用 shared)
│   │   │   │   ├── auth/    # -> 登录注册 (Slice, API, Components)
│   │   │   │   └── ...
│   │   │   ├── providers/   # -> 全局 Context (Theme, Auth, Toast)
│   │   │   └── router/      # -> 路由配置
│   │   └── package.json
│   ├── admin/                # (原 frontend-admin) 管理端 (React)
│   │   ├── src/
│   │   │   ├── features/    # 业务特性 (引用 shared)
│   │   │   └── ...
│   │   └── package.json
│   └── server/               # (原 backend) NestJS 后端
│       ├── src/
│       │   ├── modules/     # 业务模块 (引用 shared)
│       │   └── ...
│       └── package.json
├── database/                 # 数据库相关
│   ├── migrations/
│   └── init.sql
└── README.md
```

---

## 七、注意事项

### 7.1 录制与数据流转说明
- **录制来源**：用户在第三方平台（如钉钉、小程序等）完成试音和正式录制。
- **数据导入**：
  - **管理员负责**：管理员从第三方平台导出数据，然后在后台**批量上传/导入**到本系统。
  - **用户端展示**：用户在本系统（个人中心）仅做数据的**查看**（查看自己的时长、状态、收益），不进行直接上传操作。
- **标注流程**：
  - 管理员导入数据后，系统生成/关联标注任务。
  - 用户通过本系统的跳转链接进入第三方标注平台工作。
  - 管理员定期同步或导入标注结果状态。

### 7.2 用户验证
- 需要验证用户是否为邵阳学院学生
- 需要验证用户是否为长沙籍

### 7.3 数据安全
- 用户密码加密存储
- 录制文件安全存储
- 敏感操作记录日志

---

## 八、后续扩展

- 增加方言知识科普板块
- 增加社区交流功能
- 增加方言故事展示
- 数据可视化分析

---

**文档版本**: v1.1  
**创建日期**: 2026-02-09  
**更新记录**: 
- v1.1 (2026-02-09): 完善标注流程、荣誉榜单规则、后端管理功能
- v1.0 (2026-02-09): 初始版本
